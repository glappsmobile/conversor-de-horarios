//É O JSON QUE VIRÁ DO PHP
const diasJson = `{"1":{"ativo":"1","horarios":{"07:00":7,"07:30":0,"08:00":0,"08:30":1,"09:00":2,"09:30":0,"10:00":0,"10:30":5,"11:00":8,"11:30":3,"12:00":0,"12:30":0,"13:00":1,"13:30":0,"14:00":0,"14:30":0,"15:00":0,"15:30":0,"16:00":0,"16:30":0,"17:00":0,"17:30":0,"18:00":0,"18:30":0,"19:00":0,"19:30":0,"20:00":0,"20:30":0,"21:00":0,"21:30":0,"22:00":0,"22:30":0}},"2":{"ativo":"1","horarios":{"07:00":1,"07:30":0,"08:00":0,"08:30":1,"09:00":0,"09:30":1,"10:00":0,"10:30":0,"11:00":0,"11:30":1,"12:00":0,"12:30":0,"13:00":0,"13:30":0,"14:00":0,"14:30":0,"15:00":0,"15:30":0,"16:00":0,"16:30":0,"17:00":0,"17:30":0,"18:00":0,"18:30":0,"19:00":0,"19:30":0,"20:00":0,"20:30":0,"21:00":0,"21:30":0,"22:00":0,"22:30":0}},"3":{"ativo":"0","horarios":{"07:00":0,"07:30":0,"08:00":0,"08:30":0,"09:00":0,"09:30":0,"10:00":0,"10:30":0,"11:00":0,"11:30":0,"12:00":0,"12:30":0,"13:00":0,"13:30":0,"14:00":0,"14:30":0,"15:00":0,"15:30":0,"16:00":0,"16:30":0,"17:00":0,"17:30":0,"18:00":0,"18:30":0,"19:00":0,"19:30":0,"20:00":0,"20:30":0,"21:00":0,"21:30":0,"22:00":0,"22:30":0}},"4":{"ativo":"1","horarios":{"07:00":0,"07:30":0,"08:00":0,"08:30":0,"09:00":0,"09:30":0,"10:00":1,"10:30":0,"11:00":1,"11:30":0,"12:00":0,"12:30":1,"13:00":0,"13:30":0,"14:00":1,"14:30":0,"15:00":0,"15:30":0,"16:00":1,"16:30":0,"17:00":0,"17:30":1,"18:00":0,"18:30":0,"19:00":0,"19:30":0,"20:00":0,"20:30":0,"21:00":0,"21:30":0,"22:00":0,"22:30":0}},"5":{"ativo":"0","horarios":{"07:00":0,"07:30":0,"08:00":0,"08:30":0,"09:00":0,"09:30":0,"10:00":0,"10:30":0,"11:00":0,"11:30":0,"12:00":0,"12:30":0,"13:00":0,"13:30":0,"14:00":0,"14:30":0,"15:00":0,"15:30":0,"16:00":0,"16:30":0,"17:00":0,"17:30":0,"18:00":0,"18:30":0,"19:00":0,"19:30":0,"20:00":0,"20:30":0,"21:00":0,"21:30":0,"22:00":0,"22:30":0}},"6":{"ativo":"1","horarios":{"07:00":0,"07:30":0,"08:00":0,"08:30":0,"09:00":0,"09:30":0,"10:00":0,"10:30":0,"11:00":0,"11:30":0,"12:00":0,"12:30":0,"13:00":0,"13:30":0,"14:00":0,"14:30":0,"15:00":0,"15:30":0,"16:00":0,"16:30":0,"17:00":0,"17:30":0,"18:00":0,"18:30":0,"19:00":0,"19:30":0,"20:00":0,"20:30":0,"21:00":0,"21:30":0,"22:00":0,"22:30":0}},"7":{"ativo":"0","horarios":{"07:00":0,"07:30":0,"08:00":0,"08:30":0,"09:00":0,"09:30":0,"10:00":0,"10:30":0,"11:00":0,"11:30":0,"12:00":0,"12:30":0,"13:00":0,"13:30":0,"14:00":0,"14:30":0,"15:00":0,"15:30":0,"16:00":0,"16:30":0,"17:00":0,"17:30":0,"18:00":0,"18:30":0,"19:00":0,"19:30":0,"20:00":0,"20:30":0,"21:00":0,"21:30":0,"22:00":0,"22:30":0}}}`

const convertDiasToArray = (json) => {
    //PEGA O JSON BRUTO E CONVERTE NUM ARRAY MAIS LEGÍVEL
    const diasLabel = ["Segunda-feira", "Terça-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "Sábado", "Domingo"]
    const diasObject = JSON.parse(json)
    const diasKeys = Object.keys(diasObject);
    const diasArray = [];

    diasKeys.forEach(key => {
        const dia = diasLabel[Number(key) - 1];
        diasArray.push({ dia, ...diasObject[key] })
    })
    return diasArray;
}

const getHorariosAtivos = (horarios) => {
    //PEGA O OBJETO DE HORARIOS E RETORNA UM ARRAY CONTENDO OS HORARIOS COM VALOR MAIOR QUE 0
    const horariosAtivos = [];
    Object.keys(horarios).forEach(key => {
        if (horarios[key] !== 0) horariosAtivos.push({horario: key, vagas: horarios[key]})
    })
    return horariosAtivos
}

const getDiasAtivos = (dias) => {
    //FILTRA APENAS OS DIAS COM ATIVO = "1" E COM PELO MENOS UM HORARIO COM VAGAS MAIOR QUE 0
    return dias.filter(dia => dia.ativo === "1").map(dia => {
    const horariosArray = getHorariosAtivos(dia.horarios);
    if (horariosArray.length > 0) {
        dia.horarios = horariosArray;
        return dia;
    }
}).filter(dia => dia)
}

//O ARRAY FINAL COM DADOS TRATADOS, PRONTOS PARA SEREM INSERIDOS NO SELECT
const diasAtivos = getDiasAtivos(convertDiasToArray(diasJson))
